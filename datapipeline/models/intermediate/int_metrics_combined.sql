{{
    config(
        materialized="table",
        partition_by={
            "field": "upload_timestamp",
            "data_type": "datestamp",
            "granularity": "day",
        },
        tags=["metric","okta"]
    )
}}

-- Do not edit this file directly.  It is being populatd by generate_int_metrics_combined.  If you need to change this model,
-- head on over to the root of the folder and modify the python script instead

-- Updated on 2025-07-01 23:13:30

select metric_id,resource,compliance,detail,upload_timestamp, cast(upload_timestamp as date) as upload_date, {{ current_timestamp() }} as etl_timestamp from {{ ref('metric_op01_tenable_hosts_aged') }} UNION ALL
select metric_id,resource,compliance,detail,upload_timestamp, cast(upload_timestamp as date) as upload_date, {{ current_timestamp() }} as etl_timestamp from {{ ref('metric_ns01_domains_with_insecure_ports') }} UNION ALL
select metric_id,resource,compliance,detail,upload_timestamp, cast(upload_timestamp as date) as upload_date, {{ current_timestamp() }} as etl_timestamp from {{ ref('metric_us02_user_awareness') }} UNION ALL
select metric_id,resource,compliance,detail,upload_timestamp, cast(upload_timestamp as date) as upload_date, {{ current_timestamp() }} as etl_timestamp from {{ ref('metric_vm04_crowdstrike_vulnerabilities_critical_2_weeks') }} UNION ALL
select metric_id,resource,compliance,detail,upload_timestamp, cast(upload_timestamp as date) as upload_date, {{ current_timestamp() }} as etl_timestamp from {{ ref('metric_us01_user_awareness_12months') }} UNION ALL
select metric_id,resource,compliance,detail,upload_timestamp, cast(upload_timestamp as date) as upload_date, {{ current_timestamp() }} as etl_timestamp from {{ ref('metric_vm02_crowdstrike_vulnerabilities_applications') }} UNION ALL
select metric_id,resource,compliance,detail,upload_timestamp, cast(upload_timestamp as date) as upload_date, {{ current_timestamp() }} as etl_timestamp from {{ ref('metric_vm03_tenable_vulnerabilities_critical_48_hours') }} UNION ALL
select metric_id,resource,compliance,detail,upload_timestamp, cast(upload_timestamp as date) as upload_date, {{ current_timestamp() }} as etl_timestamp from {{ ref('metric_vm01_tenable_vulnerabilities_operating_system') }} UNION ALL
select metric_id,resource,compliance,detail,upload_timestamp, cast(upload_timestamp as date) as upload_date, {{ current_timestamp() }} as etl_timestamp from {{ ref('metric_vm04_tenable_vulnerabilities_critical_2_weeks') }} UNION ALL
select metric_id,resource,compliance,detail,upload_timestamp, cast(upload_timestamp as date) as upload_date, {{ current_timestamp() }} as etl_timestamp from {{ ref('metric_vm05_tenable_vulnerabilities_critical_1_month') }} UNION ALL
select metric_id,resource,compliance,detail,upload_timestamp, cast(upload_timestamp as date) as upload_date, {{ current_timestamp() }} as etl_timestamp from {{ ref('metric_vm06_crowdstrike_vulnerabilities_exploitable_unpatchable') }} UNION ALL
select metric_id,resource,compliance,detail,upload_timestamp, cast(upload_timestamp as date) as upload_date, {{ current_timestamp() }} as etl_timestamp from {{ ref('metric_op01_crowdstrike_hosts_aged') }} UNION ALL
select metric_id,resource,compliance,detail,upload_timestamp, cast(upload_timestamp as date) as upload_date, {{ current_timestamp() }} as etl_timestamp from {{ ref('metric_vm01_crowdstrike_vulnerabilities_operating_system') }} UNION ALL
select metric_id,resource,compliance,detail,upload_timestamp, cast(upload_timestamp as date) as upload_date, {{ current_timestamp() }} as etl_timestamp from {{ ref('metric_vm06_tenable_vulnerabilities_exploitable_unpatchable') }} UNION ALL
select metric_id,resource,compliance,detail,upload_timestamp, cast(upload_timestamp as date) as upload_date, {{ current_timestamp() }} as etl_timestamp from {{ ref('metric_ns02_domains_without_tls') }} UNION ALL
select metric_id,resource,compliance,detail,upload_timestamp, cast(upload_timestamp as date) as upload_date, {{ current_timestamp() }} as etl_timestamp from {{ ref('metric_im02_okta_passwords_aged') }} UNION ALL
select metric_id,resource,compliance,detail,upload_timestamp, cast(upload_timestamp as date) as upload_date, {{ current_timestamp() }} as etl_timestamp from {{ ref('metric_vm05_crowdstrike_vulnerabilities_critical_1_month') }} UNION ALL
select metric_id,resource,compliance,detail,upload_timestamp, cast(upload_timestamp as date) as upload_date, {{ current_timestamp() }} as etl_timestamp from {{ ref('metric_vm02_tenable_vulnerabilities_applications') }} UNION ALL
select metric_id,resource,compliance,detail,upload_timestamp, cast(upload_timestamp as date) as upload_date, {{ current_timestamp() }} as etl_timestamp from {{ ref('metric_im02_entra_passwords_aged') }} UNION ALL
select metric_id,resource,compliance,detail,upload_timestamp, cast(upload_timestamp as date) as upload_date, {{ current_timestamp() }} as etl_timestamp from {{ ref('metric_im01_entra_users_active') }} UNION ALL
select metric_id,resource,compliance,detail,upload_timestamp, cast(upload_timestamp as date) as upload_date, {{ current_timestamp() }} as etl_timestamp from {{ ref('metric_im01_okta_users_active') }} UNION ALL
select metric_id,resource,compliance,detail,upload_timestamp, cast(upload_timestamp as date) as upload_date, {{ current_timestamp() }} as etl_timestamp from {{ ref('metric_vm03_crowdstrike_vulnerabilities_critical_48_hours') }}
